<!-- Header with avatar -->
<div style="position: relative;">
  <!-- Background header color -->
  <div style="background-color: #933; height: 180px; border-bottom-left-radius: 60px; border-bottom-right-radius: 60px;"></div>

  <!-- Avatar container (overlapping the background) -->
  <div style="position: absolute; top: 100px; left: 50%; transform: translateX(-50%);">
    <div style="width: 160px; height: 160px; border-radius: 50%; border: 3px solid #933; background-color: white; display: flex; align-items: center; justify-content: center; overflow: hidden;">
      <% if @user.avatar.attached? %>
        <%= image_tag @user.avatar_thumbnail, alt: "#{@user.name.presence || 'User'}'s avatar",
      style: "width:100%; height:100%; object-fit:cover;" %>
      <% else %>
        <i class="fa fa-user" style="font-size:60px; color:#933;"></i>
      <% end %>
    </div>
  </div>
</div>


<!-- User info -->
<div style="margin-top:100px; text-align:center;">
  <h2 style="margin-top:20px; font-weight:bold;"><%= @user.name.presence || "Unnamed User" %></h2>
  <p style="color:#666;"><%= @user.bio.presence || "Book lover & explorer" %></p>
  <% if @user.location.present? %>
    <p style="color:#933; font-size:14px;">
      <i class="fa fa-map-marker" style="margin-right:5px;"></i>
      <%= @user.location %>
    </p>
  <% end %>
  <div style="display:flex; justify-content:center; gap:30px; margin:25px 0;">
    <div>
      <p style="font-weight:bold; font-size:20px;">122</p>
      <p style="font-size:13px; color:#666;">followers</p>
    </div>
    <div>
      <p style="font-weight:bold; font-size:20px;">67</p>
      <p style="font-size:13px; color:#666;">following</p>
    </div>
    <div>
      <p style="font-weight:bold; font-size:20px;">37K</p>
      <p style="font-size:13px; color:#666;">likes</p>
    </div>
  </div>
  <div style="display:flex; justify-content:center; gap:20px; margin-bottom:30px;">
    <% if current_user == @user %>
      <%= link_to "Edit profile", edit_user_registration_path, class: "btn", style: "background-color:#862221; color:white; padding:10px 20px; border-radius:10px;" %>
    <% end %>
    <%= link_to "Add friends", "#", class: "btn", style: "background-color:#862221; color:white; padding:10px 20px; border-radius:10px;" %>
  </div>
</div>


<!-- Tabs -->
<div style="display:flex; justify-content:center; margin-bottom:10px;">
  <div id="tab-beeread" class="tab tab-active" onclick="switchTab('beeread')" style="margin-right:30px; font-weight:bold; color:#862221; cursor:pointer;">BeRead</div>
  <div id="tab-mybooks" class="tab" onclick="switchTab('mybooks')" style="color:#aaa; cursor:pointer;">My Books</div>
</div>
<hr style="max-width:300px; margin:0 auto 30px auto;">

<!-- BeRead content -->
<div id="content-beeread">
  <% if @user_be_reads.any? %>
    <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:15px; padding:0 20px;">
      <% @user_be_reads.each do |beread| %>
        <div style="background-color:#f9f9f9; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); padding:10px; display:flex; flex-direction:column; align-items:center; position:relative;">
          <% if beread.photo.attached? %>
            <%= image_tag url_for(beread.photo), style: "border-radius:12px; width:100%; height:auto; object-fit:cover; margin-bottom:10px;" %>
          <% else %>
            <div style="width:100%; height:200px; background:#ddd; border-radius:12px; margin-bottom:10px;"></div>
          <% end %>

          <p style="font-size:14px; color:#333; text-align:center; white-space:pre-wrap;"><%= beread.caption %></p>
          <p style="font-size:12px; color:#666; margin-top:8px;">
            Posted on <%= beread.created_at.strftime("%b %d, %Y") %>
          </p>

          <% if current_user == @user %>
            <%= button_to "ðŸ—‘ Delete", be_read_path(beread), method: :delete,
                data: { confirm: "Are you sure you want to delete this BeRead?" },
                style: "position:absolute; top:10px; right:10px; background-color:#862221; color:white; border:none; padding:4px 8px; border-radius:6px; font-size:12px;" %>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <p style="text-align:center; color:#666;">No BeReads yet. Create one to see it here!</p>
  <% end %>
</div>

<!-- My Books content -->
<div id="content-mybooks" style="display: none;">
  <% if @my_books.any? %>
    <div class="books-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; padding: 20px;">
      <% @my_books.each do |library| %>
        <% data = @book_data[library.work_key] %>
        <% next if data.blank? %>

        <% work_data = data[:work_data] %>
        <% author = data[:full_author] %>
        <% reviews = data[:reviews] %>
        <% cover_id = work_data["covers"]&.first %>

        <div class="book-card" style="background: white; border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
          <%= link_to book_path(library.work_key) do %>
            <%= image_tag(
              cover_id.present? ? "https://covers.openlibrary.org/b/id/#{cover_id}-M.jpg" : "https://via.placeholder.com/140x210?text=No+Cover",
              alt: work_data["title"],
              style: "width:100%; height:auto; border-radius:8px;"
            ) %>
            <div style="margin-top: 10px; font-weight: bold; color: #333;"><%= work_data["title"] %></div>
            <div style="font-size: 14px; color: #666;"><%= author.presence || "Unknown" %></div>
            <div style="font-size: 13px; color: #888; margin-top: 6px;"><%= pluralize(reviews.count, "review") %></div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <p style="text-align: center; color: #888;">Your library is empty.</p>
  <% end %>
</div>

<!-- Tab switcher script -->
<script>
  function switchTab(tab) {
    document.getElementById("content-beeread").style.display = tab === "beeread" ? "block" : "none";
    document.getElementById("content-mybooks").style.display = tab === "mybooks" ? "block" : "none";

    document.getElementById("tab-beeread").style.color = tab === "beeread" ? "#862221" : "#aaa";
    document.getElementById("tab-mybooks").style.color = tab === "mybooks" ? "#862221" : "#aaa";

    document.getElementById("tab-beeread").style.fontWeight = tab === "beeread" ? "bold" : "normal";
    document.getElementById("tab-mybooks").style.fontWeight = tab === "mybooks" ? "bold" : "normal";
  }
</script>
