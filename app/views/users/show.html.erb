<!-- Header with avatar -->
<div style="position: relative;">
  <div style="background-color: #933; height: 180px; border-bottom-left-radius: 60px; border-bottom-right-radius: 60px;"></div>
  <div style="position: absolute; top: 100px; left: 50%; transform: translateX(-50%);">
    <div style="width: 160px; height: 160px; border-radius: 50%; border: 3px solid #933; background-color: white; display: flex; align-items: center; justify-content: center; overflow: hidden;">
      <% if @user.avatar.attached? %>
        <%= image_tag @user.avatar, style: "width:100%; height:100%; object-fit:cover;" %>
      <% else %>
        <i class="fa fa-user" style="font-size:60px; color:#933;"></i>
      <% end %>
    </div>
  </div>
</div>

<!-- User info -->
<div style="margin-top:100px; text-align:center;">
  <h2 style="margin-top:20px; font-weight:bold;"><%= @user.name || "Unnamed User" %></h2>
  <p style="color:#666;"><%= @user.bio || "Book lover & explorer" %></p>
  <% if @user.location.present? %>
    <p style="color:#933; font-size:14px;">
      <i class="fa fa-map-marker" style="margin-right:5px;"></i>
      <%= @user.location %>
    </p>
  <% end %>
  <div style="display:flex; justify-content:center; gap:30px; margin:25px 0;">
    <div><p style="font-weight:bold; font-size:20px;">122</p><p style="font-size:13px; color:#666;">followers</p></div>
    <div><p style="font-weight:bold; font-size:20px;">67</p><p style="font-size:13px; color:#666;">following</p></div>
    <div><p style="font-weight:bold; font-size:20px;">37K</p><p style="font-size:13px; color:#666;">likes</p></div>
  </div>
  <div style="display:flex; justify-content:center; gap:20px; margin-bottom:30px;">
    <%= link_to "Edit profile", edit_user_registration_path, class: "btn", style: "background-color:#862221; color:white; padding:10px 20px; border-radius:10px;" %>
    <%= link_to "Add friends", "#", class: "btn", style: "background-color:#862221; color:white; padding:10px 20px; border-radius:10px;" %>
  </div>
</div>

<!-- Tabs -->
<div style="display:flex; justify-content:center; margin-bottom:10px;">
  <div id="tab-beeread" class="tab tab-active" onclick="switchTab('beeread')" style="margin-right:30px; font-weight:bold; color:#862221; cursor:pointer;">BeRead</div>
  <div id="tab-mybooks" class="tab" onclick="switchTab('mybooks')" style="color:#aaa; cursor:pointer;">My Books</div>
</div>
<hr style="max-width:300px; margin:0 auto 30px auto;">

<!-- BeRead content -->
<div id="content-beeread">
  <% if @user.be_reads.any? %>
    <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:15px; padding:0 20px;">
      <% @user.be_reads.order(created_at: :desc).each do |beread| %>
        <div style="background-color:#f9f9f9; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); padding:10px; display:flex; flex-direction:column; align-items:center;">
          <% if beread.selfie.attached? %>
            <%= image_tag beread.selfie.variant(resize_to_limit: [300,300]), style: "border-radius:12px; width:100%; height:auto; object-fit:cover; margin-bottom:10px;" %>
          <% else %>
            <div style="width:100%; height:200px; background:#ddd; border-radius:12px; margin-bottom:10px;"></div>
          <% end %>
          <p style="font-size:14px; color:#333; text-align:center; white-space:pre-wrap;"><%= beread.text %></p>
          <p style="font-size:12px; color:#666; margin-top:8px;"><%= beread.book.title if beread.book %></p>
        </div>
      <% end %>
    </div>
  <% else %>
    <p style="text-align:center; color:#666;">No BeReads yet. Create one to see it here!</p>
  <% end %>
</div>

<!-- My Books content -->
<!-- My Books content -->
<div id="content-mybooks" style="display:none;">
  <div style="display:grid; grid-template-columns:repeat(auto-fill,minmax(130px,1fr)); gap:20px; padding:0 20px;">
    <% @my_books.each do |book| %>
      <div style="position:relative; text-align:center;">
        <% if book.cover_url.present? %>
          <%= image_tag book.cover_url, alt: book.title, style: "width:100px; height:auto; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1);" %>
        <% else %>
          <div style="width:100px; height:140px; background:#ddd; border-radius:8px; margin: 0 auto;"></div>
        <% end %>
        <p style="margin-top:8px; font-weight:bold; font-size:14px; color:#333;"><%= truncate(book.title, length:40) %></p>
        <%= link_to new_be_read_path(book_id: book.id), style: "position:absolute; bottom:8px; right:8px; background-color:#862221; color:#fff; padding:6px 10px; border-radius:6px; text-decoration:none;" do %>
          ðŸ“¸ BeRead this
        <% end %>
      </div>
    <% end %>
  </div>
  <% if @my_books.empty? %>
    <p style="text-align:center; color:#888;">Your library is empty.</p>
  <% end %>
</div>


<script>
function switchTab(tab) {
  document.getElementById("content-beeread").style.display = tab === "beeread" ? "block" : "none";
  document.getElementById("content-mybooks").style.display = tab === "mybooks" ? "block" : "none";

  document.getElementById("tab-beeread").style.color = tab === "beeread" ? "#862221" : "#aaa";
  document.getElementById("tab-mybooks").style.color = tab === "mybooks" ? "#862221" : "#aaa";

  document.getElementById("tab-beeread").style.fontWeight = tab === "beeread" ? "bold" : "normal";
  document.getElementById("tab-mybooks").style.fontWeight = tab === "mybooks" ? "bold" : "normal";
}
</script>
