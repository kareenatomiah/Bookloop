<!-- Header with avatar -->
<div style="position: relative;">
  <div style="background-color: #933; height: 180px; border-bottom-left-radius: 60px; border-bottom-right-radius: 60px;"></div>

  <div style="position: absolute; top: 100px; left: 50%; transform: translateX(-50%);">
    <div style="width: 160px; height: 160px; border-radius: 50%; border: 3px solid #933; background-color: white; display: flex; align-items: center; justify-content: center; overflow: hidden;">
      <% if @user.avatar.attached? %>
        <%= image_tag @user.avatar_thumbnail, alt: "#{@user.name.presence || 'User'}'s avatar",
          style: "width:100%; height:100%; object-fit:cover;" %>
      <% else %>
        <i class="fa fa-user" style="font-size:60px; color:#933;"></i>
      <% end %>
    </div>
  </div>
</div>

<!-- User info -->
<section style="margin-top:100px; text-align:center; font-family: 'Helvetica Neue', sans-serif;">
  <h2 style="margin-top:20px; font-weight:bold; font-size: 24px; color: #2c2c2c;">
    <%= @user.name.presence || "Unnamed User" %>
  </h2>
  <p style="color:#666; font-size: 16px; margin: 8px 0;">
    <%= @user.bio.presence || "Book lover & explorer" %>
  </p>
  <% if @user.location.present? %>
    <p style="color:#933; font-size:14px;">
      <i class="fa fa-map-marker" aria-hidden="true" style="margin-right:5px;"></i>
      <%= @user.location %>
    </p>
  <% end %>

  <div style="display:flex; justify-content:center; gap:30px; margin:25px 0; font-family: 'Helvetica Neue', sans-serif;">
    <div>
      <p style="font-weight:bold; font-size:20px; margin:0;">122</p>
      <p style="font-size:13px; color:#666; margin:0;">followers</p>
    </div>
    <div>
      <p style="font-weight:bold; font-size:20px; margin:0;">67</p>
      <p style="font-size:13px; color:#666; margin:0;">following</p>
    </div>
    <div>
      <p style="font-weight:bold; font-size:20px; margin:0;">37K</p>
      <p style="font-size:13px; color:#666; margin:0;">likes</p>
    </div>
  </div>

  <div style="display:flex; justify-content:center; gap:20px; margin-bottom:30px;">
    <% if current_user == @user %>
      <%= link_to "Edit profile", edit_user_registration_path,
            class: "btn",
            style: "background-color:#862221; color:white; padding:10px 20px; border-radius:10px; text-decoration:none;" %>
    <% end %>
    <%= link_to "Add friends", "#",
          class: "btn",
          style: "background-color:#862221; color:white; padding:10px 20px; border-radius:10px; text-decoration:none;" %>
  </div>
</section>

<!-- Tabs -->
<nav style="display:flex; justify-content:center; margin-bottom:10px; font-family: 'Helvetica Neue', sans-serif;">
  <button id="tab-beeread" class="tab tab-active" type="button"
          onclick="switchTab('beeread')"
          style="margin-right:30px; font-weight:bold; color:#862221; cursor:pointer; background:none; border:none; font-size:16px;">
    BeRead
  </button>
  <button id="tab-mybooks" class="tab" type="button"
          onclick="switchTab('mybooks')"
          style="color:#aaa; cursor:pointer; background:none; border:none; font-size:16px;">
    My Books
  </button>
</nav>
<hr style="max-width:300px; margin:0 auto 30px; border-color:#eee;">

<!-- BeRead content -->
<section id="content-beeread" aria-label="BeRead posts">
  <% if @user_be_reads.any? %>
    <div style="display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:15px; padding:0 20px;">
      <% @user_be_reads.each do |beread| %>
        <article style="background:#f9f9f9; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); padding:10px; display:flex; flex-direction:column; align-items:center; position:relative;">
          <% if beread.photo.attached? %>
            <%= image_tag url_for(beread.photo), alt: "BeRead photo", loading: "lazy",
              style: "border-radius:12px; width:100%; height:auto; object-fit:cover; margin-bottom:10px;" %>
          <% else %>
            <div style="width:100%; height:200px; background:#ddd; border-radius:12px; margin-bottom:10px;"></div>
          <% end %>

          <p style="font-size:14px; color:#333; text-align:center; white-space:pre-wrap; margin:0;"><%= beread.caption %></p>
          <p style="font-size:12px; color:#666; margin-top:8px;">Posted on <time datetime="<%= beread.created_at.iso8601 %>"><%= beread.created_at.strftime("%b %d, %Y") %></time></p>

          <% if current_user == @user %>
            <%= button_to "ðŸ—‘ Delete", be_read_path(beread), method: :delete,
                data: { confirm: "Are you sure you want to delete this BeRead?" },
                style: "position:absolute; top:10px; right:10px; background-color:#862221; color:white; border:none; padding:4px 8px; border-radius:6px; font-size:12px; cursor:pointer;" %>
          <% end %>
        </article>
      <% end %>
    </div>
  <% else %>
    <p style="text-align:center; color:#666; font-family: 'Helvetica Neue', sans-serif;">No BeReads yet. Create one to see it here!</p>
  <% end %>
</section>

<!-- My Books content -->
<section id="content-mybooks" aria-label="My Books" style="display: none; font-family: 'Helvetica Neue', sans-serif;">
  <% if @my_books.any? %>
    <div class="books-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; padding: 20px;">
      <% @my_books.each do |library| %>
        <% data = @book_data[library.work_key] %>
        <% next if data.blank? %>

        <% work_data = data[:work_data] %>
        <% author = data[:full_author] %>
        <% reviews = data[:reviews] %>
        <% cover_id = work_data["covers"]&.first %>

        <article class="book-card" style="background: white; border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
          <%= link_to book_path(library.work_key), style: "text-decoration:none; color: inherit;" do %>
            <%= image_tag(
              cover_id.present? ? "https://covers.openlibrary.org/b/id/#{cover_id}-M.jpg" : "https://via.placeholder.com/140x210?text=No+Cover",
              alt: work_data["title"] || "Book cover",
              loading: "lazy",
              style: "width:100%; height:auto; border-radius:8px;"
            ) %>
            <div style="margin-top: 10px; font-weight: bold; color: #333; font-size: 16px;"><%= work_data["title"] || "Untitled" %></div>
            <div style="font-size: 14px; color: #666; margin-top: 4px;"><%= author.presence || "Unknown" %></div>
            <div style="font-size: 13px; color: #888; margin-top: 6px;"><%= pluralize(reviews.count, "review") %></div>
          <% end %>
        </article>
      <% end %>
    </div>
  <% else %>
    <p style="text-align: center; color: #888;">Your library is empty.</p>
  <% end %>
</section>

<!-- Tab switcher script -->
<script>
  function switchTab(tab) {
    const tabs = ['beeread', 'mybooks'];
    tabs.forEach(t => {
      document.getElementById(`content-${t}`).style.display = (t === tab) ? "block" : "none";
      const tabBtn = document.getElementById(`tab-${t}`);
      tabBtn.style.color = (t === tab) ? "#862221" : "#aaa";
      tabBtn.style.fontWeight = (t === tab) ? "bold" : "normal";
    });
  }
</script>
